---
title: 如何一步步检测你的服务器是否被墙
date: 2019-07-30 13:21:28
tags:
- 爱国上网
- 被墙
- 扶墙
- 富强上网
- ss
- ssr
- v2ray
- wireguard
- gfw
---
由于在你到你的服务器间有大家都懂的不稳定的因素存在，在爱国上网软件无法链接时需要判断是否是这个不稳定因素造成的。记录一下我平常的判断方法。
<!-- more -->
由于在你到你的服务器间有大家都懂的不稳定的因素存在，在爱国上网软件无法链接时需要判断是否是这个不稳定因素造成的。记录一下我平常的判断方法。
当然前提是服务器端和客户端已经配置正确。

# 1. 排除DNS污染
之前遇到过的一个情况，线路是通的，但是就是访问不上，最后发现是本机使用的DNS被污染。
虽然现在有些爱国上网工具已经不再使用客户端DNS进行域名解析，但是某些特殊情况下利用客户端DNS解析的时候就需要排查这个问题。
在我目前遇到情况下看来，在此情况下使用nslookup每次都会返回不同的垃圾ip，并且不像正常情况下那样的返回看起来就不一样的ip。
{% asset_img 1.1.polluted.jpg %}
如果你拿这个ip去查，就会发现就是个垃圾ip。
{% asset_img 1.2.traship.png %}
但是如果用无污染的dns查询则是返回的正常结果。例如我这里用的是中科大的dns。
{% asset_img 1.3.lugu2b.JPG %}
大家也可以自行查一下这个ip。
由于dns查询的特性，境外的dns服务基本上都是属于**不可用**的状态。所以不要以为把dns改成8.8.8.8就万事大吉了。
# 2. Ping检测
这是比较原始，在一定情况下有效的方法。
前提是服务器的防火墙允许了icmp，也就是不禁ping。一般典型的服务器**畅通**的ping情况如下：
{% asset_img 1.1.baidu.JPG %}
一般典型的服务器**不畅通**的ping情况如下：
{% asset_img 1.2.google.JPG %}
如果可以确定之前服务器是可ping通的但是某天突然ping不通了，可以初步确定你的服务器ip被照顾了。


# 3. tcp连通性检测
目前可以观察到的现象是，会有tcp阻断的存在，也就是说icmp是通的，udp也是通的，只是tcp是阻断的。那在这种情况下ping通也不能代表什么了。

所以此时需要用到nmap这个工具。其实用tcping也是一样的，考虑到之后还需要做udp连通性检测，那就干脆nmap一步到位吧。

基本语法：
```
nmap -sS -p 80 www.google.com
```
```
-sS 使用tcp
-sU 使用udp
-p 80 指定端口
```
畅通时结果如下：
{% asset_img nmaptcpopen.JPG %}

否则就会如下，也就是检测不到服务器开机的：
{% asset_img nmaptcpblocked.JPG %}

当然也有可能检测到STATE是```filtered```或者```closed```，一般这两种状态是单协议阻断造成的，比如只阻断了tcp或者udp。这里找不到图就不放了。

建议在本地tcp检测是不通的之后，去[一些境外的tcp检测网站](https://www.yougetsignal.com/tools/open-ports/)试一下是不是通的，用来排除服务器本身的问题。

# 4. udp连通性检测
这种检测是针对使用的爱国工具用的是udp方式的，因为udp连通检测工具不像tcping那样好实现，所以还是用nmap来检测。
